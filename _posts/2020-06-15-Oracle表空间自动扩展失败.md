---
layout: post
title: oracle表空间自动扩展失败
categories: oracle
description: oracle表空间自动扩展失败
keywords: 数据库、oracle

---

中午的时候，运维人员发现应用服务一直报unable to extend table xxxx by 128 in tablespace xxxx,从错误来看是表空间不能扩展了。

查看表空间占用比:

```shell
SELECT UPPER(F.TABLESPACE_NAME) "表空间名",
D.TOT_GROOTTE_MB "表空间大小(M)",
D.TOT_GROOTTE_MB - F.TOTAL_BYTES "已使用空间(M)",
TO_CHAR(ROUND((D.TOT_GROOTTE_MB - F.TOTAL_BYTES) / D.TOT_GROOTTE_MB * 100,2),'990.99') "使用比",
F.TOTAL_BYTES "空闲空间(M)",
F.MAX_BYTES "最大块(M)"
FROM (SELECT TABLESPACE_NAME,
ROUND(SUM(BYTES) / (1024 * 1024), 2) TOTAL_BYTES,
ROUND(MAX(BYTES) / (1024 * 1024), 2) MAX_BYTES
FROM SYS.DBA_FREE_SPACE
GROUP BY TABLESPACE_NAME) F,
(SELECT DD.TABLESPACE_NAME,
ROUND(SUM(DD.BYTES) / (1024 * 1024), 2) TOT_GROOTTE_MB
FROM SYS.DBA_DATA_FILES DD
GROUP BY DD.TABLESPACE_NAME) D
WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME
ORDER BY 4 DESC;
```

发现XX表空间已经占用了98.8%，继续分析，查看对应表空间的存储地址

```shell
SELECT T.TABLESPACE_NAME,D.FILE_NAME,
D.AUTOEXTENSIBLE,D.BYTES,D.MAXBYTES,D.STATUS
FROM DBA_TABLESPACES T,DBA_DATA_FILES D
WHERE T.TABLESPACE_NAME =D.TABLESPACE_NAME
ORDER BY TABLESPACE_NAME,FILE_NAME;
```

找到存储地址后，下面就是扩展了，扩展有以下几种方式

```shell
手工改变已存在数据文件的大小
alter DATABASE DATAFILE '/oracle/ora11/oradata/ora11g/xx.dbf' RESIZE 20480m
允许已存在的数据文件自动增长
ALTER DATABASE DATAFILE '/oracle/ora11/oradata/ora11g/xx.dbf' AUTOEXTEND ON NEXT 100M MAXSIZE 20480M;
给表空间增加数据文件
ALTER TABLESPACE USERS ADD DATAFILE '/oracle/ora11/oradata/ora11g/xx.dbf' size 32000M
如果想让表空间自动增长需要添加 autoextend on 即：
ALTER TABLESPACE USERS ADD DATAFILE '/oracle/ora11/oradata/ora11g/xx.dbf' size 32000M AUTOEXTEND ON
一般我们在创建表空间的时候就可以添加自动增长
create bigfile tablespace USERS datafile '/oracle/ora11/oradata/ora11g/xx.dbf' size 10240m autoextend on next 512m maxsize 20480m extent management local;
设置为无限大
alter DATABASE DATAFILE '/oracle/ora11/oradata/ora11g/xx.dbf autoextend on maxsize unlimited·

```

根据实际情况进行扩展，我是设置的无限大。







