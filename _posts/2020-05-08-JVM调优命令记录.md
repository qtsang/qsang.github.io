---
layout: post
title: JVM调优命令
categories: JAVA
description: JVM调优命令记录。
keywords: Java,Jvm,调优



---

本文记录JVM调优相关命令，方便后续查询。

1、查看进程占用内存情况

```
ps aux | sort -k4,4nr | head -n 10   #查看内存占用前10名的程序

top -p 进程号      # 查看进程cpu和内存使用情况
```

2、查看进程堆使用情况

```
jmap -heap 进程号
参考 https://www.cnblogs.com/shoufeng/p/9739525.html
```

3、参考优化

```
16G内存 JDK8 生产服务器配置未验证，先丢完整配置

JAVA_OPTS="-server -Xmx4g -Xms4g -Xmn256m -Xss256k -XX:+DisableExplicitGC  -XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled -XX:LargePageSizeInBytes=128m -XX:+UseFastAccessorMethods -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 -Duser.timezone=GMT+8"

-server//服务器模式
-Xmx4g //JVM最大允许分配的堆内存，按需分配
-Xms4g //JVM初始分配的堆内存，一般和Xmx配置成一样以避免每次gc后JVM重新分配内存。
-Xmn256m //年轻代内存大小，整个JVM内存=年轻代 + 年老代 + 持久代 
-Xss512k //设置每个线程的堆栈大小
-XX:+DisableExplicitGC //忽略手动调用GC, System.gc()的调用就会变成一个空调用，完全不触发GC
-XX:+UseConcMarkSweepGC //并发标记清除（CMS）收集器
-XX:+CMSParallelRemarkEnabled //降低标记停顿
-XX:LargePageSizeInBytes=128m //内存页的大小
-XX:+UseFastAccessorMethods //原始类型的快速优化
-XX:+UseCMSInitiatingOccupancyOnly //使用手动定义初始化定义开始CMS收集
-XX:CMSInitiatingOccupancyFraction=70 //使用cms作为垃圾回收使用70％后开始CMS收集

-Duser.timezone=GMT+8 //设定GMT区域，避免CentOS坑爹的时区设置

参考http://developer.51cto.com/art/201507/486162.htm

根据运行环境去掉了

-XX:PermSize

-XX:+UseCMSCompactAtFullCollection

Xss512k 在jenkins里面会出现显示系统配置页面不正常的情况，增加到了512k
```

